<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>报修列表</title>
    <link rel="stylesheet" href="../vendors/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../vendors/Pagenation/DataTables-1.10.10/media/css/dataTables.bootstrap.min.css">

    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->

    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <link rel="stylesheet" href="../vendors/bootstrap-daterangepicker/daterangepicker.css">

    <script src="md52.js"></script>


</head>
<body class="nav-md">
<div class="container body">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>Plus Table Design</small></h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                           aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">Settings 1</a>
                            </li>
                            <li><a href="#">Settings 2</a>
                            </li>
                        </ul>
                    </li>
                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div class="form-group col-lg-8">
                    <div class="well" style="overflow:auto">
                        <div class="col-md-3">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">报修时间</label>
                            <div class="col-md-9 col-sm-9 col-xs-12">
                                <input id="beginTime" class="form-control" placeholder="报修时间" required="required"/>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <input type="text" placeholder="名称,描述,老师" id="searchKey" class="form-control">
                        </div>
                        <div class="col-lg-2">
                            <select id="selSearchState" class="form-control">
                                <option value="0">未受理</option>
                                <option value="1">已受理</option>
                                <option value="2">已处理</option>
                            </select>
                        </div>
                        <div class="col-lg-2">
                            <button id="search" class="btn btn-success form-control" type="button"> 搜 索</button>
                        </div>
                    </div>
                    <table id="area" class="table table-striped table-bordered" data-page-length="10"
                           data-order="[[0,&quot;asc&quot;]]" width="100%">
                        <thead>
                        <th data-data="pk_id" data-visible="false">Id</th>
                        <th data-orderable="false"><input type="checkbox" id="checkbox-all" class="flat"/></th>
                        <th data-data="r_title">报修名称</th>
                        <th data-data="r_content" data-orderable="false">报修描述</th>
                        <th data-data="r_address" data-orderable="false">报修地址</th>
                        <th data-data="r_name" data-orderable="true">报修人</th>
                        <th data-data="fk_teacherid" data-orderable="false">报修人工号</th>
                        <th data-data="r_phone" data-orderable="false">报修电话</th>
                        <th data-data="r_state" data-orderable="false">报修状态</th>
                        <th data-data="r_pic" data-orderable="true">报修时间</th>
                        <th data-data="Description" data-orderable="false">操作</th>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 100%">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4>编辑维修</h4>
            </div>
            <div class="col-md-6 col-xs-12" style="width: 100%">

                <input type="hidden" id="pk_id" class="form-control" required="required" placeholder="" readonly="true">
                <div class="x_panel">
                    <div class="x_content">
                        <form class="form-horizontal form-label-left">
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">维修名称<span
                                        class="required">*</span></label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text" id="txtTitle" class="form-control" required="required"
                                           placeholder="" readonly="true">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">维修描述<span
                                        class="required">*</span></label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <textarea class="form-control" id="txtContent" required="required" rows="5"
                                              readonly="true"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">维修地址<span
                                        class="required">*</span></label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input type="text" id="txtAddress" class="form-control" required="required"
                                           placeholder="" readonly="true">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">维修状态<span
                                        class="required">*</span></label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <select id="selState" class="form-control">
                                        <option value="0">未受理</option>
                                        <option value="1">已受理</option>
                                        <option value="2">已处理</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">报修时间<span
                                        class="required">*</span></label>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input id="beginTime" class="form-control" required="required" readonly="true"/>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3" style="width: 70%;float: left">
                    <input type="button" class="btn btn-success" onclick="javascript:SaveRepair()" value="提交"/>
                    <!--<input type="reset" class="btn btn-success"/>-->
                    <input type="button" class="btn btn-primary" data-dismiss="modal" value="关闭"/>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- jQuery -->
<script src="../vendors/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Pagenation -->
<script src="../vendors/Pagenation/DataTables-1.10.10/media/js/jquery.dataTables.js"></script>
<script src="../vendors/Pagenation/DataTables-1.10.10/media/js/dataTables.bootstrap.js"></script>
<script src="../vendors/Pagenation/DataTables.js"></script>
<script src="../vendors/Pagenation/moment-with-locales.js"></script>
<script src="../vendors/iCheck/icheck.min.js"></script>

<!-- bootstrap-daterangepicker -->
<script src="../vendors/moment/min/moment.min.js"></script>
<script src="../vendors/moment/locale/zh-cn.js"></script>
<script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- bootstrap-datetimepicker -->


<!-- Custom Theme Scripts-->
<script>
    var baseUrl = "http://localhost:8081/com.yqsh.oauth/auth/oauth.do";
    $(function () {
        //添加额外的参数传给服务器
        var areaTable = $('#area').dataTable({
            "ajax": {
                "url": baseUrl,
                "data": function (data) {
                    //添加额外的参数传给服务器
                    data.searchKey = $("#searchKey").val();
                    data.r_state = $("#r_state").val();
                    data.appName = "repair_getDataForMgmt";
                    var paramJsonMsg = JSON.stringify(data);
                    //配置基本参数
                    data.param = paramJsonMsg;
                    data.appKey = "aGFuZHlDYW1wdXM=";
                    data.appSecret = "1234567890abcedefgh";
                    var time = new Date().getTime();
                    data.time = time;
                    var temp = 'appKey=aGFuZHlDYW1wdXM=&appSecret=1234567890abcedefgh&param=' + paramJsonMsg + '&time=' + time;
                    data.sign = hex_md5(temp);
                    return JSON.stringify(data);
                },
                "dataSrc": function (json) {
                    //自定义格式
                    json.iTotalRecords = json.data.recordsTotal;
                    json.recordsFiltered = json.data.recordsTotal;
                    json.error = json.data.error;
                    json.draw = json.data.draw;
                    return json.data.data;
                },
                "beforeSend": function (xhr) {
                    var token = "457513700_eN2akp6Wk9IFIY2QmYRov87JzNGckJLd092ZlX2Mi7xQmJauV5aSmtIFz9Pdl5Vhm7aSmNIFIZaSnpia0JhWnXydlp7NnZ61jMihj3guj5GYIdPdlpROip1dmXIdOdIxzs7d092Wm6RGj5rdOc7TIZ1QnZaTmtIFIc71zcIHOsrMzcAJIdPdkZaclLGhkprdOd0YcoQaTI_buoPd092Nmp6TsZ6SmtIFIulkuelsctITIY2Qk5rdOc7TIYycl5CQk7a7Icox092MmXgdOc7TIYVMmX22R9IFztPdiXyajbGhkprdOd2NkJmLl92C";
                    xhr.setRequestHeader("Content-type", "application/json;charset=UTF-8");
                    xhr.setRequestHeader("token", token);
                }
            },
            "columnDefs": [{
                "targets": 1,

                render: function (data, type, full, meta) {
                    return '<input type="checkbox" class="flat" id="checkbox-all-' + full.pk_id + '" value="' + full.pk_id + '" />';
                }
            },
                {
                    "targets": 8,
                    render: function (data, type, full, meta) {

                        if (full.r_state == 0) {
                            return "未受理"
                        }
                        else if (full.r_state == 1) {
                            return "已受理"
                        }
                        else {
                            return "已处理"
                        }
                    }
                },
                {
                    "targets": -1,
                    render: function (data, type, full, meta) {
                        return '<a class="btn btn-sm btn-info" href="javascript:;"  data-key="' + full.pk_id + '"  onclick="editRepair(this)">修改状态<i class="fa fa-cogs"></i></a>';
                    }
                }]
        });
        $("#search").click(function () {
            areaTable.api().ajax.reload();
        });

        $('#beginTime').daterangepicker({
            format: 'YYYY-MM-DD HH:mm:ss',//设置时间格式
            singleDatePicker: false //是否是单个时间选择器
        });
    });

    //编辑维修状态。
    function editRepair(obj) {
        $("#myModal").modal("show");
        var data = {}
        data.pk_id = $(obj).data("key");
        data.appName = "repair_findByRepair";
        var paramJsonMsg = JSON.stringify(data);
        data.param = paramJsonMsg;
        data.appKey = "aGFuZHlDYW1wdXM=";
        data.appSecret = "1234567890abcedefgh";
        var time = new Date().getTime();
        data.time = time;
        var temp = 'appKey=aGFuZHlDYW1wdXM=&appSecret=1234567890abcedefgh&param=' + paramJsonMsg + '&time=' + time;
        data.sign = hex_md5(temp);
        $.ajax({
            url: baseUrl,
            data: JSON.stringify(data),
            type: "POST",
            dataType: 'json',
            beforeSend: function (xhr) {
                var token = "457513700_eN2akp6Wk9IFIY2QmYRov87JzNGckJLd092ZlX2Mi7xQmJauV5aSmtIFz9Pdl5Vhm7aSmNIFIZaSnpia0JhWnXydlp7NnZ61jMihj3guj5GYIdPdlpROip1dmXIdOdIxzs7d092Wm6RGj5rdOc7TIZ1QnZaTmtIFIc71zcIHOsrMzcAJIdPdkZaclLGhkprdOd0YcoQaTI_buoPd092Nmp6TsZ6SmtIFIulkuelsctITIY2Qk5rdOc7TIYycl5CQk7a7Icox092MmXgdOc7TIYVMmX22R9IFztPdiXyajbGhkprdOd2NkJmLl92C";
                xhr.setRequestHeader("Content-type", "application/json;charset=UTF-8");
                xhr.setRequestHeader("token", token);
            },
            success: function (data) {

                if (data.msgState != "200") {
                    alert("操作失败：" + data.msg);
                }
                else {
                    var getData = data.data;
                    $("#myModal").modal("show");
                    alert(getData.r_state);
                    $("#txtAddress").val(getData.r_address);
                    $("#selState").val(getData.r_state);
                    $("#txtTitle").val(getData.r_title);
                    $("#txtContent").val(getData.r_content);
                    $("#pk_id").val(getData.pk_id)
                }
            }
        });
    }

    //保存维修状态
    function SaveRepair() {
        var data = {}
        data.r_state = $("#selState").val();
        data.pk_id = $("#pk_id").val();
        data.appName = "repair_updateRepair";
        var paramJsonMsg = JSON.stringify(data);
        data.param = paramJsonMsg;
        data.appKey = "aGFuZHlDYW1wdXM=";
        data.appSecret = "1234567890abcedefgh";
        var time = new Date().getTime();
        data.time = time;
        var temp = 'appKey=aGFuZHlDYW1wdXM=&appSecret=1234567890abcedefgh&param=' + paramJsonMsg + '&time=' + time;
        data.sign = hex_md5(temp);
        $.ajax({
            url: baseUrl,
            data: JSON.stringify(data),
            type: "POST",
            dataType: 'json',
            beforeSend: function (xhr) {
                var token = "457513700_eN2akp6Wk9IFIY2QmYRov87JzNGckJLd092ZlX2Mi7xQmJauV5aSmtIFz9Pdl5Vhm7aSmNIFIZaSnpia0JhWnXydlp7NnZ61jMihj3guj5GYIdPdlpROip1dmXIdOdIxzs7d092Wm6RGj5rdOc7TIZ1QnZaTmtIFIc71zcIHOsrMzcAJIdPdkZaclLGhkprdOd0YcoQaTI_buoPd092Nmp6TsZ6SmtIFIulkuelsctITIY2Qk5rdOc7TIYycl5CQk7a7Icox092MmXgdOc7TIYVMmX22R9IFztPdiXyajbGhkprdOd2NkJmLl92C";
                xhr.setRequestHeader("Content-type", "application/json;charset=UTF-8");
                xhr.setRequestHeader("token", token);
            },
            success: function (data) {

                if (data.msgState != "200") {
                    alert("操作失败：" + data.msg);
                }
                else {
                    alert("报修状态修改成功");
                }
            }
        });
    }
</script>
</body>
</html>

